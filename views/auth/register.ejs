<div class="container-fluid vh-100">
    <div class="row h-100">
        <!-- Left side - Registration Form -->
        <div class="col-md-6 d-flex align-items-center justify-content-center">
            <div class="w-100" style="max-width: 400px;">
                <div class="text-center mb-4">
                    <i class="bi bi-bar-chart-line-fill text-primary" style="font-size: 3rem;"></i>
                    <h2 class="mt-3 mb-1">Crea Account</h2>
                    <p class="text-muted">Inizia a gestire i tuoi ETF</p>
                </div>

                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-circle me-2"></i>
                        <%= error %>
                    </div>
                <% } %>

                <form action="/auth/register" method="POST" id="registerForm">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-person"></i>
                            </span>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="username" 
                                name="username" 
                                placeholder="Scegli un username"
                                required
                                autocomplete="username"
                                pattern="[a-zA-Z0-9_]{3,50}"
                                title="3-50 caratteri, solo lettere, numeri e underscore"
                            >
                        </div>
                        <div class="form-text">3-50 caratteri, solo lettere, numeri e underscore</div>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-envelope"></i>
                            </span>
                            <input 
                                type="email" 
                                class="form-control" 
                                id="email" 
                                name="email" 
                                placeholder="La tua email"
                                required
                                autocomplete="email"
                            >
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="first_name" class="form-label">Nome</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="first_name" 
                                name="first_name" 
                                placeholder="Nome"
                                autocomplete="given-name"
                            >
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="last_name" class="form-label">Cognome</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                id="last_name" 
                                name="last_name" 
                                placeholder="Cognome"
                                autocomplete="family-name"
                            >
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-lock"></i>
                            </span>
                            <input 
                                type="password" 
                                class="form-control" 
                                id="password" 
                                name="password" 
                                placeholder="Crea una password sicura"
                                required
                                autocomplete="new-password"
                                pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
                            >
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            Minimo 8 caratteri con maiuscola, minuscola, numero e carattere speciale
                        </div>
                        <div class="progress mt-2" style="height: 5px;">
                            <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Conferma Password</label>
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="bi bi-lock-fill"></i>
                            </span>
                            <input 
                                type="password" 
                                class="form-control" 
                                id="confirmPassword" 
                                name="confirmPassword" 
                                placeholder="Conferma la password"
                                required
                                autocomplete="new-password"
                            >
                        </div>
                        <div class="invalid-feedback" id="passwordMismatch">
                            Le password non corrispondono
                        </div>
                    </div>

                    <div class="mb-4 form-check">
                        <input type="checkbox" class="form-check-input" id="acceptTerms" name="acceptTerms" required>
                        <label class="form-check-label" for="acceptTerms">
                            Accetto i <a href="#" class="text-primary">Termini di Servizio</a> e la <a href="#" class="text-primary">Privacy Policy</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 mb-3" id="submitBtn" disabled>
                        <i class="bi bi-person-plus me-2"></i>
                        Crea Account
                    </button>
                </form>

                <div class="text-center">
                    <p class="mb-0">Hai già un account?</p>
                    <a href="/auth/login" class="btn btn-outline-primary">
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        Accedi
                    </a>
                </div>
            </div>
        </div>

        <!-- Right side - Info Panel -->
        <div class="col-md-6 bg-gradient-primary text-white d-flex align-items-center">
            <div class="p-5">
                <h3 class="mb-4">Perché scegliere ETF Portfolio Manager?</h3>
                <div class="row g-4">
                    <div class="col-12">
                        <div class="card bg-transparent border-light">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="mb-0">Completamente Gratuito</h5>
                                </div>
                                <p class="mb-0 opacity-75">Tutte le funzionalità essenziali senza costi nascosti</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card bg-transparent border-light">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-shield-check-fill me-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="mb-0">Sicurezza Garantita</h5>
                                </div>
                                <p class="mb-0 opacity-75">I tuoi dati sono protetti con crittografia avanzata</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-12">
                        <div class="card bg-transparent border-light">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-2">
                                    <i class="bi bi-graph-up-arrow me-2" style="font-size: 1.5rem;"></i>
                                    <h5 class="mb-0">Analytics Professionali</h5>
                                </div>
                                <p class="mb-0 opacity-75">Strumenti di analisi avanzati per ottimizzare i tuoi investimenti</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Toggle password visibility
document.getElementById('togglePassword').addEventListener('click', function() {
    const password = document.getElementById('password');
    const icon = this.querySelector('i');
    
    if (password.type === 'password') {
        password.type = 'text';
        icon.classList.remove('bi-eye');
        icon.classList.add('bi-eye-slash');
    } else {
        password.type = 'password';
        icon.classList.remove('bi-eye-slash');
        icon.classList.add('bi-eye');
    }
});

// Password strength checker
document.getElementById('password').addEventListener('input', function() {
    const password = this.value;
    const progressBar = document.getElementById('passwordStrength');
    const submitBtn = document.getElementById('submitBtn');
    const acceptTerms = document.getElementById('acceptTerms');
    
    let strength = 0;
    let color = 'bg-danger';
    
    // Check length
    if (password.length >= 8) strength += 25;
    
    // Check lowercase
    if (password.match(/[a-z]/)) strength += 25;
    
    // Check uppercase
    if (password.match(/[A-Z]/)) strength += 25;
    
    // Check numbers
    if (password.match(/\d/)) strength += 12.5;
    
    // Check special characters
    if (password.match(/[@$!%*?&]/)) strength += 12.5;
    
    // Update progress bar
    progressBar.style.width = strength + '%';
    
    if (strength >= 75) {
        color = 'bg-success';
    } else if (strength >= 50) {
        color = 'bg-warning';
    }
    
    progressBar.className = 'progress-bar ' + color;
    
    // Enable submit button
    checkFormValidity();
});

// Confirm password validation
document.getElementById('confirmPassword').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;
    const feedback = document.getElementById('passwordMismatch');
    
    if (confirmPassword && password !== confirmPassword) {
        this.classList.add('is-invalid');
        feedback.style.display = 'block';
    } else {
        this.classList.remove('is-invalid');
        feedback.style.display = 'none';
    }
    
    checkFormValidity();
});

// Terms acceptance
document.getElementById('acceptTerms').addEventListener('change', checkFormValidity);

function checkFormValidity() {
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    const acceptTerms = document.getElementById('acceptTerms').checked;
    const submitBtn = document.getElementById('submitBtn');
    
    const passwordValid = password.length >= 8 && password.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])/);
    const passwordsMatch = password === confirmPassword;
    
    if (passwordValid && passwordsMatch && acceptTerms) {
        submitBtn.disabled = false;
    } else {
        submitBtn.disabled = true;
    }
}

// Form submission with loading state
document.getElementById('registerForm').addEventListener('submit', function(e) {
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.innerHTML = '<i class="bi bi-arrow-repeat me-2"></i>Creazione account...';
    submitBtn.disabled = true;
});
</script>
